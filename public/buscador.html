<!-- public/busqueda.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resultados de b√∫squeda - AttoMusic</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2 class="search-results-title">üîé Resultados de b√∫squeda</h2>
  <h3 class="search-section-title">Canciones</h3>
  <div id="results-tracks" class="search-results"></div>
  <h3 class="search-section-title">Artistas</h3>
  <div id="results-artists" class="search-results"></div>
  <h3 class="search-section-title">√Ålbumes</h3>
  <div id="results-albums" class="search-results"></div>

  <script>
    async function runSearch() {
      // Usa window._searchParams si existe (SPA), si no usa window.location.search (acceso directo)
      const searchStr = typeof window._searchParams === 'string' ? window._searchParams : window.location.search;
      const params = new URLSearchParams(searchStr);
      const q = params.get("q");
      const type = params.get("type") || "track,artist,album";

      if (!q) {
        document.getElementById("results-tracks").innerHTML = "<p>No se ingres√≥ b√∫squeda.</p>";
        document.getElementById("results-artists").innerHTML = "";
        document.getElementById("results-albums").innerHTML = "";
        return;
      }

  const res = await fetch(`https://attomusic.onrender.com/search?q=${encodeURIComponent(q)}&type=${type}`);
      const data = await res.json();

      mostrarTracks(data.tracks?.items || []);
      mostrarArtistas(data.artists?.items || []);
      mostrarAlbums(data.albums?.items || []);
    }

    function mostrarTracks(items) {
      const container = document.getElementById("results-tracks");
      container.innerHTML = "";
      if (items.length === 0) {
        container.innerHTML = "<p>No se encontraron canciones.</p>";
        return;
      }
      items.forEach(item => {
        const div = document.createElement("div");
        div.className = "search-card";
        let img = "";
        if (item.album?.images?.[0]?.url) img = item.album.images[0].url;
        else if (item.images?.[0]?.url) img = item.images[0].url;
        if (img && img.startsWith('icono')) img = 'images/' + img;
        div.innerHTML = `
          <h3>${item.name}</h3>
          ${img ? `<img src="${img}" alt="cover">` : ""}
          ${item.artists ? `<p>üë©‚Äçüé§ ${item.artists.map(a => a.name).join(", ")}</p>` : ""}
          ${item.album?.release_date ? `<p>üìÖ ${item.album.release_date}</p>` : ""}
          ${item.popularity !== undefined ? `<p>üî• Popularidad: ${item.popularity}</p>` : ""}
        `;
        div.style.cursor = "pointer";
        div.addEventListener("click", () => {
          window.location.href = `cancion.html?id=${item.id}`;
        });
        container.appendChild(div);
      });
    }

    function mostrarArtistas(items) {
      const container = document.getElementById("results-artists");
      container.innerHTML = "";
      if (items.length === 0) {
        container.innerHTML = "<p>No se encontraron artistas.</p>";
        return;
      }
      items.forEach(item => {
        const div = document.createElement("div");
        div.className = "search-card";
        let img = "";
        if (item.images?.[0]?.url) img = item.images[0].url;
        if (img && img.startsWith('icono')) img = 'images/' + img;
        div.innerHTML = `
          <h3>${item.name}</h3>
          ${img ? `<img src="${img}" alt="cover">` : ""}
          ${item.followers?.total ? `<p>üë• Seguidores: ${item.followers.total}</p>` : ""}
          ${item.popularity !== undefined ? `<p>üî• Popularidad: ${item.popularity}</p>` : ""}
        `;
        container.appendChild(div);
      });
    }

    function mostrarAlbums(items) {
      const container = document.getElementById("results-albums");
      container.innerHTML = "";
      if (items.length === 0) {
        container.innerHTML = "<p>No se encontraron √°lbumes.</p>";
        return;
      }
      items.forEach(item => {
        const div = document.createElement("div");
        div.className = "search-card";
        let img = "";
        if (item.images?.[0]?.url) img = item.images[0].url;
        if (img && img.startsWith('icono')) img = 'images/' + img;
        div.innerHTML = `
          <h3>${item.name}</h3>
          ${img ? `<img src="${img}" alt="cover">` : ""}
          ${item.artists ? `<p>üë©‚Äçüé§ ${item.artists.map(a => a.name).join(", ")}</p>` : ""}
          ${item.release_date ? `<p>üìÖ ${item.release_date}</p>` : ""}
        `;
        container.appendChild(div);
      });
    }

    runSearch();
  </script>
</body>
</html>
