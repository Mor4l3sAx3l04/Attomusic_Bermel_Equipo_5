
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AttoMusic</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="shortcut icon" href="images/icono.png" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
</head>
<body>


<div id="nav-generos" style="max-width:1100px;margin:32px auto 0 auto;">
  <h2 style="color:#5a189a;font-weight:900;text-align:center;">üé∂ Canciones Populares por G√©nero</h2>
  <div style="display:flex;justify-content:center;margin:18px 0 0 0;">
    <select id="select-genero" style="padding:8px 18px;border-radius:16px;font-size:1.1rem;font-weight:700;color:#5a189a;background:#f3e8ff;border:1.5px solid #ba01ff;min-width:220px;max-width:100%;">
      <option value="" disabled selected>Selecciona un g√©nero...</option>
    </select>
  <script>
  function mainCanciones() {
    const generos = [
      { nombre: "Pop", query: "genre:pop" },
      { nombre: "Rock", query: "genre:rock" },
      { nombre: "Reggaeton", query: "genre:reggaeton" },
      { nombre: "Hip Hop", query: "genre:hip hop" },
      { nombre: "Electr√≥nica", query: "genre:electronic" },
      { nombre: "Indie", query: "genre:indie" },
      { nombre: "Jazz", query: "genre:jazz" },
      { nombre: "Metal", query: "genre:metal" },
      { nombre: "Country", query: "genre:country" },
      { nombre: "Reggae", query: "genre:reggae" },
      { nombre: "Blues", query: "genre:blues" },
      { nombre: "Folk", query: "genre:folk" },
      { nombre: "Cl√°sica", query: "genre:classical" },
      { nombre: "Latina", query: "genre:latin" },
      { nombre: "Dance", query: "genre:dance" },
      { nombre: "Soul", query: "genre:soul" },
      { nombre: "Funk", query: "genre:funk" },
      { nombre: "Trap", query: "genre:trap" },
      { nombre: "R&B", query: "genre:r&b" },
      { nombre: "Alternativa", query: "genre:alternative" },
      { nombre: "Punk", query: "genre:punk" },
      { nombre: "Ska", query: "genre:ska" },
      { nombre: "Disco", query: "genre:disco" },
      { nombre: "K-Pop", query: "genre:k-pop" },
      { nombre: "Cumbia", query: "genre:cumbia" },
      { nombre: "Bachata", query: "genre:bachata" },
      { nombre: "Salsa", query: "genre:salsa" },
      { nombre: "Tango", query: "genre:tango" },
      { nombre: "Flamenco", query: "genre:flamenco" }
    ];

    // Renderiza el navegador de g√©neros
    function renderNavGeneros() {
      const select = document.getElementById('select-genero');
      select.innerHTML = '<option value="" disabled selected>Selecciona un g√©nero...</option>' +
        generos.map(g => `<option value="genero-${g.nombre.replace(/[^a-zA-Z0-9]/g,'')}">${g.nombre}</option>`).join("");
      select.addEventListener('change', function() {
        const targetId = this.value;
        const target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    }
    renderNavGeneros();

    async function cargarCancionesPopulares() {
      const cont = document.getElementById("generos-canciones");
      cont.innerHTML = "<div style='text-align:center;color:#5a189a;font-size:1.3rem;'>Cargando canciones populares...</div>";
      let html = "";
      let allTracks = [];

      // Peticiones en paralelo
      const peticiones = generos.map(genero =>
        fetch(`https://attomusic.onrender.com/search?q=${encodeURIComponent(genero.query)}&type=track&limit=12`)
          .then(res => res.json())
          .then(data => ({ genero, data }))
      );
      const resultados = await Promise.all(peticiones);

      for (const { genero, data } of resultados) {
        let allTracksGenero = data.tracks?.items || [];
        let maxPop = Math.max(...allTracksGenero.map(t => t.popularity), 0);
        let minPop = maxPop - 10;
        let tracks = allTracksGenero.filter(track => track.popularity >= minPop && track.popularity <= maxPop && maxPop > 0);
        html += `<h3 id='genero-${genero.nombre.replace(/[^a-zA-Z0-9]/g,'')}' style='color:#ba01ff;margin-top:32px;'>${genero.nombre}</h3>`;
        if (tracks.length > 0) {
          html += `<div class='row' style='margin-bottom:24px;gap:24px;display:flex;flex-wrap:wrap;'>`;
          tracks.forEach((track, idx) => {
            let img = track.album?.images?.[0]?.url || "";
            const cardId = `card-${genero.nombre.replace(/\s/g,'')}-${idx}`;
            // Tooltip agregado con title
            html += `<div class='col-md-4 col-lg-2' style='margin-bottom:18px;'>
              <div class='search-card' id='${cardId}' style='cursor:pointer;' title="üéµ ${track.name} - ${track.artists.map(a => a.name).join(", ")}">
                <h4 style='color:#5a189a;font-size:1.1rem;'>${track.name}</h4>
                ${img ? `<img src='${img}' alt='cover' style='width:100px;height:100px;border-radius:12px;margin-bottom:8px;'>` : ""}
                <p style='color:#ba01ff;font-size:0.95rem;'>${track.artists.map(a => a.name).join(", ")}</p>
                <p style='font-size:0.9rem;'>üî• Popularidad: ${track.popularity}</p>
              </div>
            </div>`;
            allTracks.push({ cardId, track });
          });
          html += `</div>`;
        } else {
          html += `<div style='color:#5a189a;font-size:1.1rem;margin-bottom:32px;text-align:center;'>No hay canciones populares en este g√©nero.</div>`;
        }
      }
      cont.innerHTML = html || "<div style='text-align:center;color:#ba01ff;font-size:1.2rem;'>No se encontraron canciones populares.</div>";
      // Asigna eventos click a cada tarjeta
      allTracks.forEach(({ cardId, track }) => {
        const card = document.getElementById(cardId);
        if (card) {
          card.addEventListener('click', () => window.mostrarDetalleCancion(track.id));
        }
      });
    }

    // Muestra el detalle de la canci√≥n, calificaci√≥n y comentario
    window.mostrarDetalleCancion = async function(id) {
      const cont = document.getElementById("generos-canciones");
      cont.innerHTML = `<div class='detalle-cancion-container' style='width:100%;height:100%;display:flex;justify-content:center;align-items:center;'><div class='search-card' id='detalle-cancion' style='max-width:500px;width:100%;margin:auto;'></div></div>`;
      const detalle = document.getElementById('detalle-cancion');
      detalle.innerHTML = `<div style='text-align:center;color:#5a189a;font-size:1.5rem;'>Cargando...</div>`;
      const res = await fetch(`https://attomusic.onrender.com/track/${id}`);
      const track = await res.json();
      let img = track.album?.images?.[0]?.url || "";
      detalle.innerHTML = `
        <button id='volver-btn' class='btn btn-outline-primary' style='margin-bottom:18px;background:linear-gradient(160deg,#ba01ff,#00dffc);color:white;border:none;'>‚üµ Volver</button>
        <h2 style='color:#5a189a;'>${track.name}</h2>
        ${img ? `<img src='${img}' alt='cover' style='width:180px;height:180px;border-radius:12px;margin-bottom:12px;'>` : ""}
        <p style='color:#ba01ff;font-weight:700;'>üë©‚Äçüé§ ${track.artists.map(a => a.name).join(", ")}</p>
        <p>üíø √Ålbum: ${track.album?.name || ""}</p>
        <p>üìÖ ${track.album?.release_date || ""}</p>
        <p>üî• Popularidad: ${track.popularity}</p>
        <div style='margin-top:18px;'>
          <h4 style='color:#ba01ff;'>Califica esta canci√≥n</h4>
          <form id='calificar-form'>
            <input type='number' id='calificacion' name='calificacion' min='1' max='5' required style='width:60px;border-radius:8px;border:1px solid #ba01ff;'>
            <button type='submit' class='btn btn-primary' style='margin-left:10px;background:linear-gradient(160deg,#ba01ff,#00dffc);border:none;'>Enviar</button>
          </form>
          <div id='calificacion-result'></div>
          <div id='comentario-section' style='margin-top:32px;text-align:center;'>
            <h4 style='color:#5a189a;font-weight:900;'>Deja un comentario</h4>
            <form id='comentario-form' style='display:inline-block;margin-top:10px;width:100%;max-width:400px;'>
              <textarea id='comentario' name='comentario' rows='3' required style='width:100%;border-radius:8px;border:1px solid #5a189a;padding:8px;'></textarea>
              <button type='submit' class='btn btn-primary' style='margin-top:10px;background:linear-gradient(160deg,#5a189a,#00dffc);border:none;width:100%;'>Enviar comentario</button>
            </form>
            <div id='comentario-result' style='margin-top:10px;'></div>
          </div>
        </div>
      `;
      document.getElementById('volver-btn').onclick = () => {
        cargarCancionesPopulares();
      };
      document.getElementById("calificar-form").addEventListener("submit", function(e) {
        e.preventDefault();
        const val = document.getElementById("calificacion").value;
        document.getElementById("calificacion-result").innerHTML = `<p style='color:#5a189a;'>¬°Gracias! Calificaste esta canci√≥n con <b>${val}</b> estrellas.</p>`;
      });
      document.getElementById("comentario-form").addEventListener("submit", function(e) {
        e.preventDefault();
        const comentario = document.getElementById("comentario").value.trim();
        if (comentario) {
          document.getElementById("comentario-result").innerHTML = `<p style='color:#5a189a;font-size:1.1rem;'>¬°Gracias por tu comentario!</p><div style='background:#f3e8ff;border-radius:8px;padding:10px;margin-top:6px;color:#5a189a;'>${comentario}</div>`;
          document.getElementById("comentario").value = "";
        }
      });
    }

    cargarCancionesPopulares();
  }
  mainCanciones();
  </script>
</body>
</html>