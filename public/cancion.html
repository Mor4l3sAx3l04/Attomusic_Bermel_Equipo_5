<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalle de Canci√≥n - AttoMusic</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="content container" id="cancion-content" style="width:100%;max-width:1000px;margin:auto;">
    <div id="track-details" style="padding:32px 0 0 0;"></div>
    <div id="calificar-section" style="margin-top:32px;text-align:center;">
      <h2 style="color:#ba01ff;font-weight:900;">Califica esta canci√≥n</h2>
      <form id="calificar-form" style="display:inline-block;margin-top:10px;">
        <input type="number" id="calificacion" name="calificacion" min="1" max="5" required style="width:60px;border-radius:8px;border:1px solid #ba01ff;">
        <button type="submit" class="btn btn-primary" style="margin-left:10px;background:linear-gradient(160deg,#ba01ff,#00dffc);border:none;">Enviar</button>
      </form>
      <div id="calificacion-result" style="margin-top:10px;"></div>
      <div id="comentario-section" style="margin-top:32px;text-align:center;">
        <h2 style="color:#5a189a;font-weight:900;">Deja un comentario</h2>
        <form id="comentario-form" style="display:inline-block;margin-top:10px;width:100%;max-width:400px;">
          <textarea id="comentario" name="comentario" rows="3" required style="width:100%;border-radius:8px;border:1px solid #5a189a;padding:8px;"></textarea>
          <button type="submit" class="btn btn-primary" style="margin-top:10px;background:linear-gradient(160deg,#5a189a,#00dffc);border:none;width:100%;">Enviar comentario</button>
        </form>
        <div id="comentario-result" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>
  <script>
    async function cargarCancion() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      if (!id) {
        document.getElementById("track-details").innerHTML = "<p style='color:#ba01ff;font-size:1.5rem;'>No se especific√≥ canci√≥n.</p>";
        return;
      }
      const res = await fetch(`https://attomusic.onrender.com/track/${id}`);
      const track = await res.json();
      let img = track.album?.images?.[0]?.url || "";
      document.getElementById("track-details").innerHTML = `
        <button id='volver-btn' class='btn btn-outline-primary' style='margin-bottom:24px;background:linear-gradient(160deg,#ba01ff,#00dffc);color:white;border:none;font-weight:700;'>‚üµ Volver a resultados</button>
        <h1 style='color:#5a189a;font-size:2.5rem;font-weight:900;text-align:center;margin-bottom:18px;'>${track.name}</h1>
        <div style='display:flex;flex-direction:column;align-items:center;'>
          ${img ? `<img src='${img}' alt='cover' style='width:220px;height:220px;border-radius:18px;margin-bottom:18px;box-shadow:0 4px 16px rgba(90,24,154,0.12),0 1.5px 6px rgba(0,223,252,0.10);'>` : ""}
          <p style='color:#ba01ff;font-weight:700;font-size:1.2rem;margin-bottom:8px;'>üë©‚Äçüé§ ${track.artists.map(a => a.name).join(", ")}</p>
          <p style='color:#5a189a;font-size:1.1rem;margin-bottom:8px;'>üíø √Ålbum: ${track.album?.name || ""}</p>
          <p style='color:#5a189a;font-size:1.1rem;margin-bottom:8px;'>üìÖ ${track.album?.release_date || ""}</p>
          <p style='color:#ff9100;font-size:1.1rem;margin-bottom:8px;'>üî• Popularidad: ${track.popularity}</p>
          ${track.preview_url ? `<audio controls src='${track.preview_url}' style='width:100%;margin-top:10px;'></audio>` : `<p style='color:#ba01ff;'>‚ö†Ô∏è No hay preview disponible</p>`}
        </div>
      `;
      document.getElementById('volver-btn').onclick = () => {
        window.history.back();
      };
    }
    cargarCancion();
    document.getElementById("calificar-form").addEventListener("submit", function(e) {
      e.preventDefault();
      const val = document.getElementById("calificacion").value;
      document.getElementById("calificacion-result").innerHTML = `<p style='color:#5a189a;font-size:1.2rem;'>¬°Gracias! Calificaste esta canci√≥n con <b>${val}</b> estrellas.</p>`;
    });
    document.getElementById("comentario-form").addEventListener("submit", function(e) {
      e.preventDefault();
      const comentario = document.getElementById("comentario").value.trim();
      if (comentario) {
        document.getElementById("comentario-result").innerHTML = `<p style='color:#5a189a;font-size:1.1rem;'>¬°Gracias por tu comentario!</p><div style='background:#f3e8ff;border-radius:8px;padding:10px;margin-top:6px;color:#5a189a;'>${comentario}</div>`;
        document.getElementById("comentario").value = "";
      }
    });
  </script>
</body>
</html>
